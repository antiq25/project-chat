{% extends 'layout.html' %}
{% block content %}

</head>
<meta name="csrf-token" content="{{ csrf_token() }}"> <!-- Flask's CSRF token for secured POST requests -->

<body class="text-bg-black" onload="document.getElementById('message').focus(); scrollBottom();">

<div id="app" class="app app-content-full-width app-sidebar-collapsed">
<div id="header" class="app-header text-bg-black">
<div class="desktop-toggler">
<button type="button" class="menu-toggler" data-toggle-class="app-sidebar-collapsed" data-dismiss-class="app-sidebar-toggled" data-toggle-target=".app">
<span class="bar"></span>
<span class="bar"></span>
<span class="bar"></span>
</button>
</div>

<div class="mobile-toggler">
<button type="button" class="menu-toggler" data-toggle-class="app-sidebar-mobile-toggled" data-toggle-target=".app">
<span class="bar"></span>
<span class="bar"></span>
<span class="bar"></span>
</button>
</div>
<div class="brand">
<a href="index-2.html" class="brand-logo">
<span class="brand-img">
<span class="brand-img-text text-theme">EQ</span>
</span>
<span class="brand-text">eq network</span>
</a>
</div>


<div class="menu">
<div class="menu-item dropdown">
<a href="#" data-toggle-class="app-header-menu-search-toggled" data-toggle-target=".app" class="menu-link">
<div class="menu-icon"><i class="bi bi-search nav-icon"></i></div>
</a>
</div>
<div class="menu-item dropdown dropdown-mobile-full">
<a href="#" data-bs-toggle="dropdown" data-bs-display="static" class="menu-link">
<div class="menu-icon"><i class="bi bi-grid-3x3-gap nav-icon"></i></div>
</a>
<div class="dropdown-menu fade dropdown-menu-end w-300px text-center p-0 mt-1">
<div class="row row-grid gx-0">
<div class="col-4">
<a href="email_inbox.html" class="dropdown-item text-decoration-none p-3 bg-none">
<div class="position-relative">
<i class="bi bi-circle-fill position-absolute text-theme top-0 mt-n2 me-n2 fs-6px d-block text-center w-100"></i>
<i class="bi bi-envelope h2 opacity-5 d-block my-1"></i>
</div>
<div class="fw-500 fs-10px text-inverse">INBOX</div>
</a>
</div>
<div class="col-4">
<a href="pos_customer_order.html" target="_blank" class="dropdown-item text-decoration-none p-3 bg-none">
<div><i class="bi bi-hdd-network h2 opacity-5 d-block my-1"></i></div>
<div class="fw-500 fs-10px text-inverse">POS SYSTEM</div>
</a>
</div>
<div class="col-4">
<a href="calendar.html" class="dropdown-item text-decoration-none p-3 bg-none">
<div><i class="bi bi-calendar4 h2 opacity-5 d-block my-1"></i></div>
<div class="fw-500 fs-10px text-inverse">CALENDAR</div>
</a>
</div>
</div>
<div class="row row-grid gx-0">
<div class="col-4">
<a href="helper.html" class="dropdown-item text-decoration-none p-3 bg-none">
<div><i class="bi bi-terminal h2 opacity-5 d-block my-1"></i></div>
<div class="fw-500 fs-10px text-inverse">HELPER</div>
</a>
</div>
<div class="col-4">
<a href="settings.html" class="dropdown-item text-decoration-none p-3 bg-none">
<div class="position-relative">
<i class="bi bi-circle-fill position-absolute text-theme top-0 mt-n2 me-n2 fs-6px d-block text-center w-100"></i>
<i class="bi bi-sliders h2 opacity-5 d-block my-1"></i>
</div>
<div class="fw-500 fs-10px text-inverse">SETTINGS</div>
</a>
</div>
<div class="col-4">
<a href="widgets.html" class="dropdown-item text-decoration-none p-3 bg-none">
<div><i class="bi bi-collection-play h2 opacity-5 d-block my-1"></i></div>
<div class="fw-500 fs-10px text-inverse">WIDGETS</div>
</a>
</div>
</div>
</div>
</div>
<div class="menu-item dropdown dropdown-mobile-full">
<a href="#" data-bs-toggle="dropdown" data-bs-display="static" class="menu-link">
<div class="menu-icon"><i class="bi bi-bell nav-icon"></i></div>
<div class="menu-badge bg-theme"></div>
</a>
<div class="dropdown-menu dropdown-menu-end mt-1 w-300px fs-11px pt-1">
<h6 class="dropdown-header fs-10px mb-1">NOTIFICATIONS</h6>
<div class="dropdown-divider mt-1"></div>
<a href="#" class="d-flex align-items-center py-10px dropdown-item text-wrap fw-semibold">
<div class="fs-20px">
    <!--   -->
<i class="bi bi-bag text-theme"></i>
</div>
<div class="flex-1 flex-wrap ps-3">
<div class="mb-1 text-inverse">NEW ORDER RECEIVED ($1,299)</div>
<div class="small text-inverse text-opacity-50">JUST NOW</div>
</div>
<div class="ps-2 fs-16px">
<i class="bi bi-chevron-right"></i>
</div>
</a>
<a href="#" class="d-flex align-items-center py-10px dropdown-item text-wrap fw-semibold">
<div class="fs-20px w-20px">
<i class="bi bi-person-circle text-theme"></i>
</div>
<div class="flex-1 flex-wrap ps-3">
<div class="mb-1 text-inverse">3 NEW ACCOUNT CREATED</div>
<div class="small text-inverse text-opacity-50">2 MINUTES AGO</div>
</div>
<div class="ps-2 fs-16px">
<i class="bi bi-chevron-right"></i>
</div>
</a>
<a href="#" class="d-flex align-items-center py-10px dropdown-item text-wrap fw-semibold">
<div class="fs-20px w-20px">
<i class="bi bi-gear text-theme"></i>
</div>
<div class="flex-1 flex-wrap ps-3">
<div class="mb-1 text-inverse">SETUP COMPLETED</div>
<div class="small text-inverse text-opacity-50">3 MINUTES AGO</div>
</div>
<div class="ps-2 fs-16px">
<i class="bi bi-chevron-right"></i>
</div>
</a>
<a href="#" class="d-flex align-items-center py-10px dropdown-item text-wrap fw-semibold">
<div class="fs-20px w-20px">
<i class="bi bi-grid text-theme"></i>
</div>
<div class="flex-1 flex-wrap ps-3">
<div class="mb-1 text-inverse">WIDGET INSTALLATION DONE</div>
<div class="small text-inverse text-opacity-50">5 MINUTES AGO</div>
</div>
<div class="ps-2 fs-16px">
<i class="bi bi-chevron-right"></i>
</div>
</a>
<a href="#" class="d-flex align-items-center py-10px dropdown-item text-wrap fw-semibold">
<div class="fs-20px w-20px">
<i class="bi bi-credit-card text-theme"></i>
</div>
<div class="flex-1 flex-wrap ps-3">
<div class="mb-1 text-inverse">PAYMENT METHOD ENABLED</div>
<div class="small text-inverse text-opacity-50">10 MINUTES AGO</div>
</div>
<div class="ps-2 fs-16px">
<i class="bi bi-chevron-right"></i>
</div>
</a>
<hr class="my-0">
<div class="py-10px mb-n2 text-center">
<a href="#" class="text-decoration-none fw-bold">SEE ALL</a>
</div>
</div>
</div>
<div class="menu-item dropdown dropdown-mobile-full">
<a href="#" data-bs-toggle="dropdown" data-bs-display="static" class="menu-link">
<div class="menu-img online">
<img src="../static/uploads/default_image.png" alt="Profile" height="60">
</div>
<div class="menu-text d-sm-block d-none w-170px"><span class="__cf_email__" data-cfemail="70050315021e111d15301113131f051e045e131f1d">[email&#160;protected]</span></div>
</a>
<div class="dropdown-menu dropdown-menu-end me-lg-3 fs-11px mt-1">
<a class="dropdown-item d-flex align-items-center" href="profile.html">PROFILE <i class="bi bi-person-circle ms-auto text-theme fs-16px my-n1"></i></a>
<a class="dropdown-item d-flex align-items-center" href="email_inbox.html">INBOX <i class="bi bi-envelope ms-auto text-theme fs-16px my-n1"></i></a>
<a class="dropdown-item d-flex align-items-center" href="calendar.html">CALENDAR <i class="bi bi-calendar ms-auto text-theme fs-16px my-n1"></i></a>
<a class="dropdown-item d-flex align-items-center" href="settings.html">SETTINGS <i class="bi bi-gear ms-auto text-theme fs-16px my-n1"></i></a>
<div class="dropdown-divider"></div>
<a class="dropdown-item d-flex align-items-center" href="page_login.html">LOGOUT <i class="bi bi-toggle-off ms-auto text-theme fs-16px my-n1"></i></a>
</div>
</div>
</div>


<form class="menu-search" method="POST" name="header_search_form">
<div class="menu-search-container">
<div class="menu-search-icon"><i class="bi bi-search"></i></div>
<div class="menu-search-input">
<input type="text" class="form-control form-control-lg" placeholder="Search menu...">
</div>
<div class="menu-search-icon">
<a href="#" data-toggle-class="app-header-menu-search-toggled" data-toggle-target=".app"><i class="bi bi-x-lg"></i></a>
</div>
</div>
</form>

</div>


<div id="sidebar" class="app-sidebar bg-gradient text-bg-black">

<div class="app-sidebar-content" data-scrollbar="true" data-height="100%">
    <span id="notificationCount" style="display: none;">0</span> <!-- Initially hidden. Will be shown when there are notifications. -->
    <div id="notificationList">

<div class="menu">
<div class="menu-header">Navigation</div>
<div class="menu-item">
<a href="index-2.html" class="menu-link">
<span class="menu-icon"><i class="bi bi-cpu"></i></span>
<span class="menu-text">Dashboard</span>
</a>
<div class="menu-divider"></div>
<div class="menu-header">Users</div>
<div class="menu-item">
<a href="profile.html" class="menu-link">
<span class="menu-icon"><i class="bi bi-people"></i></span>
<span class="menu-text">Profile</span>
</a>
</div>
<div class="menu-item">
<a href="calendar.html" class="menu-link">
<span class="menu-icon"><i class="bi bi-calendar4"></i></span>
<span class="menu-text">Calendar</span>
</a>
</div>
<div class="menu-item">
<a href="settings.html" class="menu-link">
<span class="menu-icon"><i class="bi bi-gear"></i></span>
<span class="menu-text">Settings</span>
</a>
</div>
<div class="menu-item">
<a href="helper.html" class="menu-link">
<span class="menu-icon"><i class="bi bi-gem"></i></span>
<span class="menu-text">Helper</span>
</a>
</div>
</div>


</div>
</div>
</div>
</div>




<button class="app-sidebar-mobile-backdrop" data-toggle-target=".app" data-toggle-class="app-sidebar-mobile-toggled"></button>

<div class="card h-100">
    <div class="messenger">
        <div class="messenger-sidebar">
       
            <div class="messenger-sidebar-header">
                <h3 class="mb-10px">Chats</h3>
                <div class="position-relative">
                    <button type="submit" class="btn text-inverse position-absolute top-0"><i class="bi bi-search"></i></button>
                    <input type="text" class="form-control rounded-pill ps-35px" placeholder="Search Messenger">
                </div>
            </div>
          
            <div class="messenger-sidebar-body" id="update_user_list">
                <div data-scrollbar="true" data-height="100%" class="ps" data-init="true">
                    <!-- Loop to list the online users -->
                    {% for user in users_online %}
                    <div class="messenger-item">
                       <a href="{{ url_for('private_chat', receiver_id=user.id) }}" data-toggle="messenger-content" class="messenger-link">

                            <div class="messenger-media">
                                <img src="{{ url_for('static', filename=(user.profile_pic if user.profile_pic else 'uploads/default_image.webp')) }}"
                                    alt="{{ (user.display_name if user.display_name else 'Default User') }}" width="50" class="card-img">
                            </div>
                            <div class="messenger-info">
                                <div class="messenger-name" >{{ user.display_name or user.username }}</div>

                                <div class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown">Options</a>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" href="/profile/{{ user.id }}">View Profile</a>
                                        <a class="dropdown-item" href="{{ url_for('private_chat', receiver_id=user.id) }}">Chat with {{ user.username or user.display_name }}</a>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                {% endfor %}
                </div>
            </div>
        </div>

            <div class="messenger-content">
                <div class="messenger-content-header">
                <div class="messenger-content-header-mobile-toggler">
                <a href="#" data-toggle="messenger-content" class="me-2">
                <i class="bi bi-chevron-left"></i>
                </a>
                    <a href="#" class="btn btn-link"><i class="bi bi-search"></i></a>
                    <div class="dropdown">
                    <a href="#" class="btn btn-link" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                    <div class="dropdown-menu fs-12px fw-bold">
                    <a href="#" class="dropdown-item d-flex align-items-center"><i class="bi bi-pencil-square fs-14px my-n1 me-2"></i> EDIT</a>
                    <a href="#" class="dropdown-item d-flex align-items-center"><i class="bi bi-info-circle fs-14px my-n1 me-2"></i> INFO</a>
                    <a href="#" class="dropdown-item d-flex align-items-center"><i class="bi bi-bell-slash fs-14px my-n1 me-2"></i> MUTE</a>
                    <a href="#" class="dropdown-item d-flex align-items-center"><i class="bi bi-x-circle fs-14px my-n1 me-2"></i> CLEAR CHAT HISTORY</a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item d-flex align-items-center text-danger"><i class="bi bi-trash fs-14px my-n1 me-2"></i> DELETE AND LEAVE</a>
                    </div>
                    </div>
                </div>
                <!-- ... your header content ... -->
            </div>

            <div class="messenger-content-body invisible">
                <div data-scrollbar="true" data-height="100%">                    
                    <div class="widget-chat" id="chatbox">
                        <div class="widget-chat-date">TODAY</div>
                        {% for message in messages %}
                            <div class="widget-chat-item">
                                <div class="widget-chat-media">
                                    <img src="{{ url_for('static', filename=(message.sender.profile_pic if message.sender.profile_pic else 'uploads/default_image.webp')) }}"
                                        alt="{{ (message.sender.display_name if message.sender.display_name else 'Default User') }}" width="30" class="card-img">
                                </div>
                                <div class="widget-chat-content">
                                    <div>
                                    </div>
                                    <div class="widget-chat-name">{{ message.sender.display_name or message.sender.username }}</div>
                                    <div class="widget-chat-message last">
                                        {{ message.content }}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="messenger-content-footer">
                <div class="input-group input-group-lg position-relative z-3">
                    <button class="btn text-inverse position-absolute start-0" id="trigger"><i class="fa fa-smile-o" aria-hidden="true"></i></button>
                    <input type="text" class="form-control rounded-start ps-45px" id="message" placeholder="Write a message..." onkeydown="checkKey(event)">
                    <button class="btn btn-outline-default" onclick="sendMessage()" id="message-button"><i class="fa fa-paper-plane text-muted"></i></button>
                </div>
            </div>
        </div>
    </div>
    <div class="card-arrow">
        <div class="card-arrow-top-left"></div>
        <div class="card-arrow-top-right"></div>
        <div class="card-arrow-bottom-left"></div>
        <div class="card-arrow-bottom-right"></div>
    </div>
</div>
<!-- Private Message Modal -->
  
<!-- Start modals -->



<div class="modal fade" id="userModal" aria-hidden="true" aria-labelledby="userModalLabel" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="userModalLabel">User Profile</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <img id="userModalImage" src="" alt="User Profile Image" width="100" class="img-fluid">
          <h6 id="userModalName"></h6>
       
          <div class="modal-footer">
         
        <a class="btn btn-outline-inverse" href="{{ url_for('profile', user_id=user.id) }}">View Profile</a>
        <a class="btn grad4 btn-outline-black" href="{{ url_for('private_chat', receiver_id=user.id) }}">Private Chat</a>
       

      </div>     

        </div>
      </div>
    </div>
  </div>
  
  
  <div class="modal fade" id="mainModal" tabindex="-1" aria-labelledby="mainModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="mainModalLabel">Document</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Your content starts here -->
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div id="notificationList">
                                <div id="notificationCount"></div>
                            </div>
                            <div class="col-xl-8">
                                <div class="card">
                                    <div class="card-header bg-none fw-bold d-flex align-items-center">
                                        <h3>Private Messages with {{ receiver.username }}:</h3>
                                        <a href="#" class="ms-auto text-muted text-decoration-none" data-toggle="card-expand"
                                            data-height="400px">
                                            <i class="fa fa-expand"></i>
                                        </a>
                                    </div>
                                </div>
                                <ul>
                                    {% for sender in senders %}
                                    {% if loop.index <= 10 %} 
                                    <li><a href="{{ url_for('private_chat', receiver_id=sender.id) }}">{{ sender.username }}</a></li>
                                    {% endif %}
                                    {% endfor %}
                                </ul>

                                <h2>All Received Messages:</h2>
                                <ul>
                                    {% for message in received_messages %}
                                    {% if loop.index <= 10 %} 
                                    <li><strong>{{ message.sender.username }}:</strong> {{ message.content }} <small>{{ message.timestamp }}</small></li>
                                    {% endif %}
                                    {% endfor %}
                                </ul>

                                <!-- Online users section -->
                                <div class="card">
                                    <div class="card-header bg-none fw-bold d-flex align-items-center">
                                        <h3>Online Users:</h3>
                                    </div>
                                    <div class="card-body">
                                        <div id="notificationElement"></div>
                                        <div class="messenger-list" id="update_user_list">
                                            <a href="{{ url_for('private_chat', receiver_id=user.id) }}"
                                                data-toggle="messenger-content"></a>
                                            {% for user in users_online %}
                                            <div class="messenger-media">
                                                <img src="{{ url_for('static', filename=(user.profile_pic if user.profile_pic else 'uploads/default_image.webp')) }}"
                                                    alt="{{ (user.display_name if user.display_name else 'Default User') }}"
                                                    width="50" class="card-img">
                                            </div>
                                            <div class="messenger-info">
                                                <div class="messenger-name">{{ user.display_name or user.username }}</div>
                                                <div class="dropdown">
                                                    <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown">Options</a>
                                                    <div class="dropdown-menu">
                                                        <a class="dropdown-item" href="/profile/{{ user.id }}">View Profile</a>
                                                        <a class="dropdown-item"
                                                            href="{{ url_for('private_chat', receiver_id=user.id) }}">Chat with {{
                                                            user.username or user.display_name }}</a>
                                                    </div>
                                                </div>
                                            </div>
                                            </a>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                <style>
                                    .modal-backdrop {
                                        z-index: 0;
                                    }
                                </style>
                                <div class="modal fade " id="userModal" aria-hidden="true" aria-labelledby="userModalLabel"
                                    tabindex="-1">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="userModalLabel">User Profile</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <img id="userModalImage" src="" alt="User Profile Image" width="100"
                                                    class="img-fluid">
                                                <h6 id="userModalName"></h6>

                                                <div class="modal-footer">

                                                    <a class="btn btn-outline-inverse"
                                                        href="{{ url_for('profile', user_id=user.id) }}">View Profile</a>
                                                    <a class="btn grad4 btn-outline-black"
                                                        href="{{ url_for('private_chat', receiver_id=user.id) }}">Private Chat</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <script src="../static/assets/js/app.min.js"></script>
                            <script src="../static/assets/js/vendor.min.js"></script>
                            <script src="../static/js/bootstrap.bundle.min.js"></script>
                        </div>
                    </div>
                </div>
                <!-- Your content ends here -->
            </div>
        </div>
    </div>
</div>

<!-- Trigger button for the modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#mainModal">
    Open Main Modal
</button>




  

 
 
  
  
  


<script type="module" src="../static/js/page-messenger.demo.js"></script>

{% endblock %}

