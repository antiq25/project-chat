<script src="../static/js/socket.io.min.js"></script>

<!-- connect client, emits user id to join  -->
<script>
    const socket = io.connect(location.origin);
        socket.on("connect", () => {
            socket.emit("join", { user_id: "{{ current_user.id }}" });
        });

  </script>

  <!-- This is essential for the socket to connect properly  -->
<style>
  #notificationDot {
    position: relative;
    display: block;
    top: 10px; /* Adjust to fit your design */
    right: 10px; /* Adjust to fit your design */
      width: 10px;
      height: 10px;
      border-radius: 50; /* Makes it a circle */
    }
    
    .hidden {
      display: none;
    }
    
    .show {
      display: block !important;
    }


  </style>

  <div class="menu">
    <div class="menu-item dropdown">
    <a href="#" data-toggle-class="app-header-menu-search-toggled" data-toggle-target=".app" class="menu-link">
      <div class="menu-icon"><i class="bi bi-search nav-icon"></i></div>
    </a>
  </div>
  <div class="menu-item dropdown dropdown-mobile-full">
    <a href="#" data-bs-toggle="dropdown" data-bs-display="static" class="menu-link">
      <div class="menu-icon"><i class="bi bi-grid-3x3-gap nav-icon"></i></div>
    </a>
    <div class="dropdown-menu fade dropdown-menu-end w-300px text-center p-0 mt-1">
      <div class="row row-grid gx-0">
        <div class="col-4">
          <a href="email_inbox.html" class="dropdown-item text-decoration-none p-3 bg-none">
            <div class="position-relative">
              <i class="bi bi-circle-fill position-absolute text-theme top-0 mt-n2 me-n2 fs-6px d-block text-center w-100"></i>
              <i class="bi bi-envelope h2 opacity-5 d-block my-1"></i>
            </div>
            <div class="fw-500 fs-10px text-inverse">INBOX</div>
          </a>
        </div>
        <div class="col-4">
          <a href="pos_customer_order.html" target="_blank" class="dropdown-item text-decoration-none p-3 bg-none">
            <div><i class="bi bi-hdd-network h2 opacity-5 d-block my-1"></i></div>
            <div class="fw-500 fs-10px text-inverse">POS SYSTEM</div>
          </a>
        </div>
        <div class="col-4">
          <a href="calendar.html" class="dropdown-item text-decoration-none p-3 bg-none">
            <div><i class="bi bi-calendar4 h2 opacity-5 d-block my-1"></i></div>
              <div class="fw-500 fs-10px text-inverse">CALENDAR</div>
            </a> 
          </div>
        </div>
        <div class="row row-grid gx-0">
          <div class="col-4">
            <a href="helper.html" class="dropdown-item text-decoration-none p-3 bg-none">
              <div><i class="bi bi-terminal h2 opacity-5 d-block my-1"></i></div>
              <div class="fw-500 fs-10px text-inverse">HELPER</div>
            </a>
          </div>
          <div class="col-4">
            <a href="settings.html" class="dropdown-item text-decoration-none p-3 bg-none">
              <div class="position-relative">
                <i class="bi bi-circle-fill position-absolute text-theme top-0 mt-n2 me-n2 fs-6px d-block text-center w-100"></i>
                <i class="bi bi-sliders h2 opacity-5 d-block my-1"></i>
              </div>
              <div class="fw-500 fs-10px text-inverse">SETTINGS</div>
            </a>
          </div>
          <div class="col-4">
            <a href="widgets.html" class="dropdown-item text-decoration-none p-3 bg-none">
              <div><i class="bi bi-collection-play h2 opacity-5 d-block my-1"></i></div>
              <div class="fw-500 fs-10px text-inverse">WIDGETS</div>
            </a>
          </div>
        </div>
      </div>
    </div>
    <div class="menu-item dropdown dropdown-mobile-full">
      <a href="#" data-bs-toggle="dropdown" data-bs-display="static" class="menu-link">
        <span id="notificationDot" onclick="hideDot()" style="display:none;">â€¢</span>
        <span id="notificationCount"></span>
        <div class="menu-icon"><i class="bi bi-bell nav-icon"></i></div>
        <div class="dropdown-menu dropdown-menu-end mt-1 w-300px fs-11px pt-1">
          <h6 class="dropdown-header fs-10px mb-1">NOTIFICATIONS</h6>
          <div class="dropdown-divider mt-1"></div>
          <div href="#" class="d-flex align-items-center py-10px dropdown-item text-wrap fw-semibold">
            <div class="fs-20px">
              <i class="bi bi-bag text-theme"></i>
              <div id="notificationList"></div>
            </a>
          </div>
        </div>
        <div class="dropdown-divider mt-1"></div>
      </div>
    </div>
    <div class="menu-item dropdown bg-blue">
      <a href="#" data-bs-toggle="dropdown" data-bs-display="static" class="menu-link">
        <div class="menu-img online">
          <img src="../static/uploads/default_image.png" alt="Profile" height="60">
        </div>
        <div class="menu-text d-sm-block d-none w-170px"><span class="__cf_email__" data-cfemail="70050315021e111d15301113131f051e045e131f1d"></span></div>
      </a>
      <div class="dropdown-menu dropdown-menu-end me-lg-3 fs-11px mt-1">
        <a class="dropdown-item d-flex align-items-center" href="/profile">PROFILE <i class="bi bi-person-circle ms-auto text-theme fs-16px my-n1"></i></a>
        <a class="dropdown-item d-flex align-items-center" href="email_inbox.html">INBOX <i class="bi bi-envelope ms-auto text-theme fs-16px my-n1"></i></a>
        <a class="dropdown-item d-flex align-items-center" href="calendar.html">CALENDAR <i class="bi bi-calendar ms-auto text-theme fs-16px my-n1"></i></a>
        <a class="dropdown-item d-flex align-items-center" href="settings.html">SETTINGS <i class="bi bi-gear ms-auto text-theme fs-16px my-n1"></i></a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item d-flex align-items-center" href="/logout">LOGOUT <i class="bi bi-toggle-off ms-auto text-theme fs-16px my-n1"></i></a>
      </div>
    </div>
  </div>

  

        
</div>
<!--  create this into a professional sidebar -->
<div id="chat-sidebar" class="sidebar">
    <!-- Toggler Button -->
    
<div id="sidebar" class="app-sidebar app-sidebar-collapse bg-blue-500">
    <!-- Toggler Button --> 
<button type="button" class="btn btn-ai w-85 mb-3" onclick="toggleSidebar()">
    <i class="bi bi-layout-text-sidebar-reverse"></i>
</button>


    <!-- Toggle Chat Button -->
    <button onclick="toggleChat()" class="btn btn-ai w-85 mb-3">Toggle Chat
      <i class="bi-chat-text"></i>
    </button>

   
    <!-- Chat Content -->
    <div id="chatContent" style="display: none;">
        <h5 class="menu-header">Online Users</h5>
        <div id="onlineUsers" data-scrollbar="true" data-height="100%" class="ps mb-4">
            <!-- JavaScript will populate this with online users -->
        </div>

        <div id="privateChatContent" style="display: none;">
            <h5>Private Messages with <span id="receiverUsername"></span>:</h5>
            <div class="shadow-6 mb-4" style="height: 400px; overflow-y: scroll;" id="private-messages">
                {% for message in private_messages %}
                    <div class="widget-chat-content mb-2">
                        {% if message.profile_pic %}
                            <img src="{{ message.profile_pic }}" alt="Profile Picture" width="30" height="30" class="rounded-circle me-2">
                        {% endif %}
                        <div>
                            <strong>{{ message.display_name }}</strong>: {{ message.content }} 
                        </div>
                    </div>
                {% endfor %}
            </div>

            <div id="chatbox-private" class="variantOverlay">
                <form id="private-chat-form" class="chatbox">
                    <div class="input-group mb-2">
                        <input type="text" id="private-message-input" placeholder="Type your message" class="form-control" style="resize: none;" rows="1"/>
                        <div class="input-group-append">
                            <button type="submit" class="btn btn-primary">Send</button>
                        </div>
                    </div>
                </form>

                <div class="text-center">
                    <a href="/" class="btn btn-secondary">Back to Global Chat</a>
                    <a href="/logout" class="btn btn-danger">Logout</a>
                </div>
            </div>
        </div>
    </div>


