<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="csrf-token" content="{{ csrf_token() }}"> <!-- Flask's CSRF token for secured POST requests -->

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- Define Styles -->

    <link rel="stylesheet" href="../static/assets/css/app.min.css">
    <!-- Define Scripts -->
    <link rel="stylesheet" href="../static/assets/css/vendor.min.css">
    <script src="../static/js/socket.io.min.js"></script>
    <script>
        var socket = io.connect();  // This is the connection to client-side socket.io!
        console.log('Connected to the server.');
    </script>
    <script src="../static/js/users_update.js"></script>
</head>

<body class="bg-gradient">
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div id="notificationList">
                    <div id="notificationCount"></div>
                </div>
                <div class="col-xl-8">
                    <div class="card">
                        <div class="card-header bg-none fw-bold d-flex align-items-center">
                            <a href="#" class="ms-auto text-muted text-decoration-none" data-toggle="card-expand"
                                data-height="400px">
                                <i class="fa fa-expand"></i>
                            </a>
                        </div>
                    </div>
                    <ul>
                        {% for sender in senders %}
                        {% if loop.index <= 10 %} <li><a href="{{ url_for('private_chat', receiver_id=sender.id) }}">{{
                                sender.username }}</a></li>
                            {% endif %}
                            {% endfor %}
                    </ul>

                    <h2>All Received Messages:</h2>
                    <ul>
                        {% for message in received_messages %}
                        {% if loop.index <= 10 %} <li><strong>{{ message.sender.username }}:</strong> {{ message.content
                            }} <small>{{ message.timestamp }}</small></li>
                            {% endif %}
                            {% endfor %}
                    </ul>




                    <!-- Online users section -->
                    <div class="card">
                        <div class="card-header bg-none fw-bold d-flex align-items-center">
                            <h3>Online Users:</h3>
                        </div>
                        <div class="card-body">
                            <div id="notificationElement"></div>
                            <div class="messenger-list" id="update_user_list">
                                <a href="{{ url_for('private_chat', receiver_id=user.id) }}"
                                    data-toggle="messenger-content"></a>
                                {% for user in users_online %}
                                class="messenger-link">
                                <div class="messenger-media">
                                    <img src="{{ url_for('static', filename=(user.profile_pic if user.profile_pic else 'uploads/default_image.webp')) }}"
                                        alt="{{ (user.display_name if user.display_name else 'Default User') }}"
                                        width="50" class="card-img">
                                </div>
                                <div class="messenger-info">
                                    <div class="messenger-name">{{ user.display_name or user.username }}</div>
                                    <div class="dropdown">
                                        <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown">Options</a>
                                        <div class="dropdown-menu">
                                            <a class="dropdown-item" href="/profile/{{ user.id }}">View Profile</a>
                                            <a class="dropdown-item"
                                                href="{{ url_for('private_chat', receiver_id=user.id) }}">Chat with {{
                                                user.username or user.display_name }}</a>
                                        </div>
                                    </div>
                                </div>
                                </a>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <style>
                        .modal-backdrop {
                            z-index: 0;
                        }
                    </style>
                    ]<div class="modal fade " id="userModal" aria-hidden="true" aria-labelledby="userModalLabel"
                        tabindex="-1">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="userModalLabel">User Profile</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <img id="userModalImage" src="" alt="User Profile Image" width="100"
                                        class="img-fluid">
                                    <h6 id="userModalName"></h6>

                                    <div class="modal-footer">

                                        <a class="btn btn-outline-inverse"
                                            href="{{ url_for('profile', user_id=user.id) }}">View Profile</a>
                                        <a class="btn grad4 btn-outline-black"
                                            href="{{ url_for('private_chat', receiver_id=user.id) }}">Private Chat</a>


                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <script src="../static/assets/js/app.min.js"></script>
                <script src="../static/assets/js/vendor.min.js"></script>
                <script src="../static/js/bootstrap.bundle.min.js"></script>
</body>

</html>